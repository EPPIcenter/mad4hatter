nextflow_workflow {

    name "Test Workflow CONCATENATE_TARGETED_REFERENCE"
    script "subworkflows/local/concatenate_targeted_reference.nf"
    workflow "CONCATENATE_TARGETED_REFERENCE"

    test("Should run without failures with multiple pools") {

        when {
            params {
                pools = 'D1,R1,R2'

                pool_options = [
                    D1: [
                        amplicon_info_path: 'panel_information/D1.1/D1.1_amplicon_info.tsv',
                        targeted_reference_path: 'panel_information/D1.1/D1.1_reference.fasta'
                    ],
                    R1: [
                        amplicon_info_path: 'panel_information/R1.2/R1.2_amplicon_info.tsv',
                        targeted_reference_path: 'panel_information/R1.2/R1.2_reference.fasta'
                    ],
                    R2: [
                        amplicon_info_path: 'panel_information/R2.1/R2.1_amplicon_info.tsv',
                        targeted_reference_path: 'panel_information/R2.1/R2.1_reference.fasta'
                    ]
                ]
            }
        }

        then {
            assert workflow.success
            assert workflow.out.reference_fasta
            assert path(workflow.out.reference_fasta.get(0)).md5 == "cbc3e8aca784b9cdcec810b96eb59c57"
            assert workflow.trace.tasks().size() == 1
        }

    }

    test("Should run without failures with single pool") {

        when {
            params {
                pools = 'D1, R1, R2'

                pool_options = [
                    D1: [
                        amplicon_info_path: 'panel_information/D1.1/D1.1_amplicon_info.tsv',
                        targeted_reference_path: 'panel_information/D1.1/D1.1_reference.fasta'
                    ],
                    R1: [
                        amplicon_info_path: 'panel_information/R1.2/R1.2_amplicon_info.tsv',
                        targeted_reference_path: 'panel_information/R1.2/R1.2_reference.fasta'
                    ],
                    R2: [
                        amplicon_info_path: 'panel_information/R2.1/R2.1_amplicon_info.tsv',
                        targeted_reference_path: 'panel_information/R2.1/R2.1_reference.fasta'
                    ]
                ]
            }
        }

        then {
            assert workflow.success
            assert workflow.out.reference_fasta
            assert path(workflow.out.reference_fasta.get(0)).md5 == "cbc3e8aca784b9cdcec810b96eb59c57"
            assert workflow.trace.tasks().size() == 1
        }

    }

    test("Should run without failures with multiple pools with spaces") {

        when {
            params {
                pools = 'D1'

                pool_options = [
                    D1: [
                        amplicon_info_path: 'panel_information/D1.1/D1.1_amplicon_info.tsv',
                        targeted_reference_path: 'panel_information/D1.1/D1.1_reference.fasta'
                    ],
                    R1: [
                        amplicon_info_path: 'panel_information/R1.2/R1.2_amplicon_info.tsv',
                        targeted_reference_path: 'panel_information/R1.2/R1.2_reference.fasta'
                    ],
                    R2: [
                        amplicon_info_path: 'panel_information/R2.1/R2.1_amplicon_info.tsv',
                        targeted_reference_path: 'panel_information/R2.1/R2.1_reference.fasta'
                    ]
                ]
            }
        }

        then {
            assert workflow.success
            assert workflow.out.reference_fasta
            assert path(workflow.out.reference_fasta.get(0)).md5 == "61428c295629f58a728504a3f85da232"
            assert workflow.trace.tasks().size() == 1
        }

    }


}
