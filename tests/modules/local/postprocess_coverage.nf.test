nextflow_process {

    name "Test Process POSTPROCESS_COVERAGE"
    script "modules/local/postprocess_coverage.nf"
    process "POSTPROCESS_COVERAGE"

    test("Should run without failures") {

        when {
            params {
                alleledata = "${projectDir}/tests/example_data/allele_data.txt"
                clusters = "${projectDir}/tests/example_data/dada2.clusters.txt"
                sample_coverage = "${projectDir}/tests/example_data/sample_coverage.txt"
                amplicon_coverage = "${projectDir}/tests/example_data/amplicon_coverage.txt"
            }
            process {
                """
                input[0] = params.alleledata
                input[1] = params.clusters
                input[2] = params.sample_coverage
                input[3] = params.amplicon_coverage
                """
            }
        }

        then {
            assert process.success
            assert process.out.postprocess_sample_coverage
            assert process.out.postprocess_amplicon_coverage
            assert path(process.out.postprocess_sample_coverage.get(0)).md5 == "ad1bd1a491ab08b0965f4d1e9bc014c4"
            assert path(process.out.postprocess_amplicon_coverage.get(0)).md5 == "0d483ad5011ffbebe59e01c4e1401e54"
        }

    }

}