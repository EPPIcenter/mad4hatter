nextflow_process {

    name "Test Process MASK_SEQUENCES"
    script "modules/local/mask_sequences.nf"
    process "MASK_SEQUENCES"

    test("Running with reference with homopolymer masking should run successfully") {

        when {
            params {
                masks = "${projectDir}/tests/example_data/dummy_targeted_ref_masked_homo.fasta"
                alignments = "${projectDir}/tests/example_data/dummy_alignments.txt"

            }
            process {
                """
                input[0] = params.masks
                input[1] = params.alignments
                """
            }
        }

        then {
            assert process.success
            assert process.out.masked_alignments
            assert path(process.out.masked_alignments.get(0)).md5 == "e74088206f0ce87668ed55b444850155"
        }

    }

    test("Running with reference with tr masking should run successfully") {

        when {
            params {
                masks = "${projectDir}/tests/example_data/dummy_targeted_ref_masked_tr.fasta"
                alignments = "${projectDir}/tests/example_data/dummy_alignments.txt"

            }
            process {
                """
                input[0] = params.masks
                input[1] = params.alignments
                """
            }
        }

        then {
            assert process.success
            assert process.out.masked_alignments
            assert path(process.out.masked_alignments.get(0)).md5 == "190fd44cbce0f4a65a37ae9ed1326969"
        }

    }

    test("Running with reference with multiple masking should run successfully") {

        when {
            params {
                masks = ["${projectDir}/tests/example_data/dummy_targeted_ref_masked_homo.fasta","${projectDir}/tests/example_data/dummy_targeted_ref_masked_tr.fasta"]
                alignments = "${projectDir}/tests/example_data/dummy_alignments.txt"

            }
            process {
                """
                input[0] = params.masks
                input[1] = params.alignments
                """
            }
        }

        then {
            assert process.success
            assert process.out.masked_alignments
            assert path(process.out.masked_alignments.get(0)).md5 == "a30476af7726d196318718b2f2a19eec"
        }

    }
    
}
