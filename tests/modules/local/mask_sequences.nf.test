nextflow_process {

    name "Test Process MASK_SEQUENCES"
    script "modules/local/mask_sequences.nf"
    process "MASK_SEQUENCES"

    test("Running with reference with homopolymer masking should run successfully") {

        when {
            params {
                masks = "${projectDir}/tests/example_data/dummy_targeted_ref_masked_homo.fasta"
                alignments = "${projectDir}/tests/example_data/dummy_alignments.txt"

            }
            process {
                """
                input[0] = params.masks
                input[1] = params.alignments
                """
            }
        }

        then {
            assert process.success
            assert process.out.masked_alignments
            assert path(process.out.masked_alignments.get(0)).md5 == "65be02cffb23692c4c8bb39fca2ae556"
        }

    }

    test("Running with reference with tr masking should run successfully") {

        when {
            params {
                masks = "${projectDir}/tests/example_data/dummy_targeted_ref_masked_tr.fasta"
                alignments = "${projectDir}/tests/example_data/dummy_alignments.txt"

            }
            process {
                """
                input[0] = params.masks
                input[1] = params.alignments
                """
            }
        }

        then {
            assert process.success
            assert process.out.masked_alignments
            assert path(process.out.masked_alignments.get(0)).md5 == "eb52cc5bcddc8e5bf6a14a3f801d1876"
        }

    }

    test("Running with reference with multiple masking should run successfully") {

        when {
            params {
                masks = ["${projectDir}/tests/example_data/dummy_targeted_ref_masked_homo.fasta","${projectDir}/tests/example_data/dummy_targeted_ref_masked_tr.fasta"]
                alignments = "${projectDir}/tests/example_data/dummy_alignments.txt"

            }
            process {
                """
                input[0] = params.masks
                input[1] = params.alignments
                """
            }
        }

        then {
            assert process.success
            assert process.out.masked_alignments
            assert path(process.out.masked_alignments.get(0)).md5 == "bdc2b564d3523b0b772a6c6b7c577fad"
        }

    }
    
}
